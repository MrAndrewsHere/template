x-app: &x-app
    build:
        context: .
        dockerfile: ./docker/app/Dockerfile
    env_file:
        - .env
    container_name: ${APP_NAMESPACE}-app
    depends_on:
        - db
        - redis
    networks:
        - laravel_network

services:
    app:
        <<: *x-app
        #        user: "${UID:-1000}:${GID:-1000}"
        ports:
            - "8080:8080"
        volumes:
            - .:/var/www/html
            - ./docker/supervisor/common.conf:/etc/supervisor/common.conf
            - ./docker/supervisor/dev.conf:/etc/supervisor/conf.d/supervisord.conf
            - ./docker/app/php.ini:/usr/local/etc/php/php.ini
            - ./Caddyfile:/etc/caddy/Caddyfile
    db:
        image: postgres:latest
        env_file:
            - .env
        container_name: ${APP_NAMESPACE}-db
        environment:
            POSTGRES_DB: ${DB_DATABASE}
            POSTGRES_USER: ${DB_USERNAME}
            POSTGRES_PASSWORD: ${DB_PASSWORD}
        networks:
            - laravel_network

    redis:
        image: redis:latest
        container_name: ${APP_NAMESPACE}-redis
        restart: unless-stopped
        env_file:
            - .env
        networks:
            - laravel_network

#    buggregator:
#        image: ghcr.io/buggregator/server:dev
#        ports:
#            - 127.0.0.1:8000:8000
#            - 127.0.0.1:1025:1025
#            - 127.0.0.1:9912:9912
#            - 127.0.0.1:9913:9913
#        networks:
#            - laravel_network

networks:
    laravel_network:
